(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-85e64aba"],{"5d60":function(e,t,r){"use strict";r.r(t);r("8e6e"),r("456d"),r("55dd"),r("28a5");var a=r("3835"),n=(r("7514"),r("ade3")),i=(r("7f7f"),r("ac6a"),r("2f62")),s=r("ed08"),o=r("c24f"),c=r("cc5e"),u=r("b578");function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){Object(n["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e){return e.forEach((function(e){e.id=e.uuid,e.label=e.name,e.value=e.uuid,e.children&&e.children.length&&(e.children=m(e.children))})),e}t["default"]={computed:d({},Object(i["b"])(["id"])),data:function(){return{isSuperAdmin:!1,parentDepartIds:[],departTreeData:[],sortParam:{properties:"updateTime",direction:"desc"},form:{name:"",departSelect:[],departSelectParentId:[],selectDepart:"",status:""},props:{value:"id",label:"name",children:"children"},node:null,nodeData:null,allNodes:[],dialogFormVisible:!1,formLabelWidth:"6em",currentPage:1,limit:10,total:0,searchInput:"",seachSelect:"1",dateTimeValue:"",userform:{roleData:[],departSelect:[],name:"",account:"",departId:"2",roleId:"",password1:"",password2:"",sex:!0,email:"",phone:"",status:!0,state:""},dialogUserFormVisible:!1,userTableData:[],multipleSelection:[],multipleSelectionId:[],roleFormVisible:!1,roleDataTable:[],departRules:{name:[{required:!0,validator:function(e,t,r){return""===t.trim()?r(new Error("请输入部门名称")):/^\s+/.test(t)||/\s+$/.test(t)?r(new Error("部门名称首尾不能含有空格")):void r()},trigger:"blur"},{min:1,max:16,message:"请输入1-16位的部门名称",trigger:"blur, change"}],departSelect:[{required:!0,validator:this.checkDepart,trigger:"change"}]},userRules:{name:[{required:!0,validator:function(e,t,r){return""===t.trim()?r(new Error("请输入用户名称")):/^\s+/.test(t)||/\s+$/.test(t)?r(new Error("用户名称首尾不能含有空格")):void r()},trigger:"blur"},{min:1,max:16,message:"请输入1-16位的用户名称",trigger:"blur, change"}],account:[{required:!0,validator:function(e,t,r){return""===t.trim()?r(new Error("请输入登录账号")):/^[^ ]+$/.test(t)?void r():r(new Error("登录账号不能含有空格"))},trigger:"blur"},{min:1,max:16,message:"请输入1-16位的登录账号",trigger:"blur, change"}],departSelect:[{type:"array",required:!0,message:"请选择所在部门",trigger:"change"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{validator:function(e,t,r){var a=/^[0-9]*$/;if(!a.test(t))return r(new Error("请输入正确的电话号码"));r()},trigger:"blur"},{min:1,max:16,message:"请输入正确的电话号码",trigger:"blur"}]},loginSettingDialog:{visible:!1,form:{id:"",lockTime:30,sessionValidity:5},rule:{}}}},created:function(){this.loadGroupData(),this.getRoleData(),this.loadUserData()},destroyed:function(){},methods:{loginSetting:function(){var e=this;userManageRequest.loginConfigs((function(t){1==t.length&&userManageRequest.loginConfigById(t[0].id,(function(t){e.loginSettingDialog.form.id=t.uuid,e.loginSettingDialog.form.lockTime=t.lockTime,e.loginSettingDialog.form.sessionValidity=t.sessionValidity,e.loginSettingDialog.visible=!0}))}))},submitLoginSetting:function(){var e=this,t=d({},this.loginSettingDialog.form);userManageRequest.updateLoginConfig(t,(function(){e.loginSettingDialog.visible=!1,e.$message({message:"修改成功",type:"success"})}))},lock:function(){var e=this;1==this.multipleSelection.length?4!==this.multipleSelection[0].status?this.$confirm("此操作将会锁定已选中的用户，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){console.log(e.multipleSelection[0]),Object(o["d"])(e.multipleSelection[0].id).then((function(t){var r=t.data;if(r){var a=d(d({},r),{},{status:4,retryCount:0,retryCountDate:null});Object(o["n"])(a).then((function(){e.loadUserData(),e.$message({type:"success",message:"锁定成功",center:!0})}))}}))})).catch((function(){})):this.$message({message:"请选择未锁定的用户！",type:"warning"}):this.$message({message:"请选择一名用户进行操作",type:"warning"})},unlock:function(){var e=this;1==this.multipleSelection.length?4===this.multipleSelection[0].status?this.$confirm("此操作将会解锁已选中的用户，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["d"])(e.multipleSelection[0].id).then((function(t){var r=t.data;if(r){var a=d(d({},r),{},{status:5,retryCount:0,retryCountDate:null});Object(o["n"])(a).then((function(){e.loadUserData(),e.$message({type:"success",message:"解锁成功",center:!0})}))}}))})).catch((function(){})):this.$message({message:"请选择待解锁的用户！",type:"warning"}):this.$message({message:"请选择一名用户进行操作",type:"warning"})},checkDepart:function(e,t,r){var a=this;if(!t.length)return r(new Error("请选择所在部门"));if("edit"===this.form.status){if(this.form.departSelect.find((function(e){return e===a.nodeData.id})))return r(new Error("不能选择自己或下级部门作为上级部门"));r()}else r()},loadGroupData:function(){var e=this;Object(u["c"])().then((function(t){var r=t.data,a=m(r);function n(e){for(var t=0;t<e.length;t++)e[t].children?n(e[t].children):delete e[t].children}n(a),e.departTreeData=a}))},loadUserData:function(){var e=this,t={name:"",account:"",phone:"",beginTime:this.dateTimeValue?this.dateTimeValue[0]:"",endTime:this.dateTimeValue?this.dateTimeValue[1]:"",departId:this.nodeData?this.nodeData.id:""};switch(this.seachSelect){case"1":t.account=this.searchInput;break;case"2":t.name=this.searchInput;break;case"3":t.phone=this.searchInput;break}var r={page:this.currentPage,size:this.limit};this.sortParam&&(r.properties=this.sortParam.properties,r.direction=this.sortParam.direction),Object(o["f"])(r,t).then((function(t){var r=t.data;e.userTableData=r.rows.map((function(t,r){var n=e.searchValue(e.departTreeData,t.departId),i=Object(a["a"])(n,4);i[0],i[1],i[2],i[3];return{id:t.uuid,name:t.name,sex:1===t.sex?"男":"女",email:t.email,phone:t.phone,account:t.account,departName:t.departmentName,roleNames:t.roleNames,status:t.status,createTime:Object(s["c"])(t.createTime),updateTime:Object(s["c"])(t.updateTime)}})),e.total=r.totalSize}))},getRoleData:function(){var e=this;Object(c["c"])().then((function(t){var r=t.data;e.userform.roleData=r}))},handleSizeChange:function(e){this.currentPage=1,this.limit=e,this.loadUserData()},handleCurrentChange:function(e){this.currentPage=e,this.loadUserData()},nodeClick:function(e,t,r){this.node=t,this.nodeData=e,e&&(e.parentIdList.push(e.id),this.parentDepartIds=e.parentIdList),this.loadUserData()},departHandler:function(e){var t=this,r=this;switch(e){case"add":this.form.status=e,this.dialogFormVisible=!0,this.$refs.departRule&&this.$refs.departRule.resetFields(),this.form.name="",this.form.departSelect=this.parentDepartIds,this.form.title="添加部门";break;case"edit":if(this.nodeData){if(this.form.title="编辑部门",this.form.status=e,this.$refs.departRule&&this.$refs.departRule.resetFields(),"0"===this.nodeData.parentId)return void r.$message({message:"无法编辑根部门",type:"warning",center:!0});var a=this.$refs.tree.getCurrentNode().id;Object(u["d"])(a).then((function(e){var t=e.data;r.dialogFormVisible=!0,r.form.selectDepart=t,r.form.name=t.name;var a=t.parentIds.split(",");a.shift(),a.pop(),r.form.departSelect=a}))}else r.$message({message:"请选择1个部门",type:"warning",center:!0});break;case"delete":this.node?"0"===this.nodeData.parentId?r.$message({message:"无法删除根部门",type:"warning",center:!0}):Object(s["a"])(this.nodeData,!0,"部门")&&this.$confirm("此操作将删除选中的部门, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e=t.nodeData.id;Object(u["b"])(e).then((function(e){r.loadGroupData(),t.$message.success(e.message)}))})).catch((function(){})):r.$message({message:"请选择1个部门",type:"warning",center:!0});break}},departHandleChange:function(e){this.form.departSelect=e},addDepart:function(e){var t=this,r=this;this.$refs[e].validate((function(e){if(!e)return!1;if("add"===t.form.status){var a={name:t.form.name,parentId:t.form.departSelect[t.form.departSelect.length-1]};Object(u["a"])(a).then((function(){r.loadGroupData(),r.dialogFormVisible=!1,t.$message.success("增加成功")}))}if("edit"===t.form.status){a={name:t.form.name,parentId:t.form.departSelect[t.form.departSelect.length-1]};var n=t.form.selectDepart.uuid;Object(u["e"])(n,a).then((function(){r.loadGroupData(),r.dialogFormVisible=!1,t.$message({type:"success",message:"修改成功",center:!0})}))}}))},cancelAddDepart:function(e){this.dialogFormVisible=!1,this.form.name="",this.form.departSelect=[],this.$refs[e].resetFields()},selectChange:function(e){this.form.departSelect=e,this.seachSelect=e},searchChange:function(){this.currentPage=1,this.loadUserData()},dateChange:function(){this.loadUserData()},userSelectionChange:function(e){this.multipleSelection=e,this.multipleSelectionId=this.multipleSelection.map((function(e,t){return e.id}))},addUser:function(){this.dialogUserFormVisible=!0,this.$refs.userRule&&this.$refs.userRule.resetFields(),this.userFormEmpty(),this.userform.state="add",this.userform.title="添加用户"},editUser:function(){var e=this;if(1==this.multipleSelection.length){this.$refs.userRule&&this.$refs.userRule.resetFields(),this.userFormEmpty(),this.userform.state="edit",this.userform.title="编辑用户";var t={userId:this.multipleSelection[0].id};Object(o["d"])(t.userId).then((function(t){var r=t.data;e.userform.account=r.account,e.userform.name=r.name,e.userform.sex=String(r.sex),e.userform.email=r.email,e.userform.phone=r.phone,e.userform.status=r.status,e.userform.departSelect=r.departIdPath.split(","),e.dialogUserFormVisible=!0}))}else this.$message({message:"请选择一名用户进行操作",type:"warning"})},deleteUser:function(){var e=this,t=this;if(this.multipleSelection.length>=1){if(this.multipleSelectionId.join(",").indexOf(this.id)>-1)return void this.$message({type:"warning",message:"不允许删除当前账号",center:!0});this.$confirm("此操作将删除选中的用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r=e.multipleSelectionId.join(",");Object(o["b"])(r).then((function(){t.loadUserData(),t.$message({type:"success",message:"删除成功",center:!0})}))})).catch((function(){}))}else this.$message({message:"请至少选择一名用户进行删除操作",type:"warning"})},resetUserPass:function(){var e=this,t=this;this.multipleSelection.length>=1&&this.$confirm("此操作将重置选中的用户的密码为MIT118@%product, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={userIds:e.multipleSelectionId.join(",")};Object(o["k"])(r).then((function(){t.loadUserData(),t.$message({type:"success",message:"重置成功",center:!0})}))})).catch((function(){}))},setRole:function(){var e=this;this.multipleSelection.length>=1?(e.roleFormVisible=!0,1===this.multipleSelection.length&&Object(o["g"])(this.multipleSelection[0].id).then((function(t){var r=t.data,a=r;if(a)for(var n=0;n<a.length;n++)for(var i=0;i<e.userform.roleData.length;i++)a[n].uuid===e.userform.roleData[i].uuid&&e.$refs.roleDataTable.toggleRowSelection(e.userform.roleData[i],!0)}))):this.$message({message:"请至少选择一个角色",type:"warning"})},roleDataChange:function(e){this.roleDataTable=e},changeRole:function(){var e=this;if(this.roleDataTable.length>=1){var t=this.multipleSelection.map((function(e){return e.id})),r=this.roleDataTable.sort((function(e,t){return e.updateTime-t.updateTime})).map((function(e){return e.uuid})),a={userIds:t.join(","),roleIds:r.join(",")};Object(o["l"])(a.userIds,a.roleIds).then((function(){e.$message({type:"success",message:"分配成功",center:!0}),e.roleFormVisible=!1,e.loadUserData()})),this.$refs.roleDataTable.clearSelection()}else this.$message({message:"请至少选择一个角色",type:"warning"})},cancelChangeRole:function(){this.roleFormVisible=!1,this.$refs.roleDataTable.clearSelection()},freeze:function(){var e=this,t=this;GlobalUtils.checkSelectStatus(t.multipleSelection,"禁用")&&GlobalUtils.checkSelectCount(t.multipleSelection,1,">=",!0,"用户")&&this.$confirm("此操作将禁用选中的用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={userIds:e.multipleSelectionId.join(",")};Object(o["c"])(r).then((function(){t.loadUserData(),e.$message({type:"success",message:"禁用成功",center:!0})}))})).catch((function(){}))},unfreeze:function(){var e=this,t=this;GlobalUtils.checkSelectStatus(t.multipleSelection,"启用")&&GlobalUtils.checkSelectCount(t.multipleSelection,1,">=",!0,"用户")&&this.$confirm("此操作将启用选中的用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var r={userIds:e.multipleSelectionId.join(",")};Object(o["m"])(r).then((function(){t.loadUserData(),e.$message({type:"success",message:"启用成功",center:!0})}))})).catch((function(){}))},sureAddUser:function(e){var t=this,r=this;this.$refs[e].validate((function(e){if(!e)return!1;if("add"===t.userform.state){var a={name:t.userform.name,sex:t.userform.sex,email:t.userform.email,phone:t.userform.phone,account:t.userform.account,password:"MIT118@%product",departId:t.userform.departSelect[t.userform.departSelect.length-1],departIdPath:t.userform.departSelect.join(","),status:5};Object(o["a"])(a).then((function(e){200==e.code&&(t.$message.success("增加成功"),t.dialogUserFormVisible=!1,t.loadUserData())}))}if("edit"==t.userform.state){var n={name:t.userform.name,sex:t.userform.sex,email:t.userform.email,phone:t.userform.phone,account:t.userform.account,departId:t.userform.departSelect[t.userform.departSelect.length-1],departIdPath:t.userform.departSelect.join(","),status:t.userform.status};n.uuid=t.multipleSelection[0].id,Object(o["n"])(n).then((function(){r.loadUserData(),r.userFormEmpty(),r.dialogUserFormVisible=!1,r.$message({type:"success",message:"修改成功",center:!0})}))}}))},cancelAddUser:function(e){this.dialogUserFormVisible=!1,this.userFormEmpty()},userFormEmpty:function(){this.userform.name="",this.userform.account="",this.userform.roleId="",this.userform.departSelect=this.parentDepartIds,this.userform.password1="",this.userform.password2="",this.userform.sex="1",this.userform.email="",this.userform.phone=""},onTableRowClick:function(e,t,r){console.log(e),this.$refs.multipleTable.toggleRowSelection(e)},onRoleTableRowClick:function(e,t,r){this.$refs.roleDataTable.toggleRowSelection(e)},searchValue:function(e,t){for(var r=0;r<e.length;r++){var n=[],i=[],s=[],o=e[r];if(n.push(o.id),i.push(o.parentId),s.push(o.name),o.id===t)return[!0,n,i,s];if(o.children){var c=this.searchValue(o.children,t),u=Object(a["a"])(c,4),l=u[0],d=u[1],m=u[2],h=u[3];if(l)return[!0,n.concat(d),i.concat(m),s.concat(h)]}}return[!1,[]]},onTableSortChange:function(e){console.log(e),this.sortParam={},this.sortParam.properties=e.prop,"departName"===this.sortParam.properties&&(this.sortParam.properties="departId"),"roleName"===this.sortParam.properties&&(this.sortParam.properties="roleId"),this.sortParam.direction="ascending"===e.order?"asc":"desc",this.loadUserData()}}}},b578:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"e",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"d",(function(){return o})),r.d(t,"c",(function(){return c}));var a=r("b775");function n(e){return Object(a["a"])({url:"/department/add",method:"post",data:e})}function i(e){return Object(a["a"])({url:"/department/update",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/department/delete",method:"post",data:{departmentIds:e}})}function o(e){return Object(a["a"])({url:"/department/query/".concat(e),method:"get"})}function c(){return Object(a["a"])({url:"/department/tree",method:"get"})}},cc5e:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"f",(function(){return i})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return o})),r.d(t,"c",(function(){return c})),r.d(t,"b",(function(){return u}));var a=r("b775");function n(e){return Object(a["a"])({url:"role/add",method:"post",data:e})}function i(e){return Object(a["a"])({url:"/role/update",method:"post",data:e})}function s(e){return Object(a["a"])({url:"/role/query/".concat(e),method:"get"})}function o(e){return Object(a["a"])({url:"/role/page",method:"post",data:e})}function c(){return Object(a["a"])({url:"/role/list",method:"get"})}function u(e){return Object(a["a"])({url:"/role/delete",method:"post",data:{roleIds:e}})}}}]);